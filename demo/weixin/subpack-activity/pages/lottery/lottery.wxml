
<view class="lottery-wrap" wx:if="{{ !loading }}">

    <!-- 头图 -->
    <view class="lottery-banner" wx:if="{{ bannerUrl }}">
        <image mode="widthFix" src="{{ bannerUrl }}" lazy-load="false"/>
    </view>

    <!-- 抽奖 -->
    <view class="lottery-main">
        <view class="main-title">
            <text class="title">{{ luckyTitle }}</text>
            <text class="rule" bindtap="tapLuckyRule">活动规则</text>
        </view>
        <view class="main-info">
            <view class="main-record">
                <button 
                    class="lottery-login" 
                    hover-class="btn-hover" 
                    type="success" 
                    open-type="getUserInfo"
                    bindtap="originLogin"
                    wx:if="{{ !isLogin }}">
                </button>
                <view class="button" bindtap="tapLuckyRecord">
                    <image mode="widthFix" src="{{ lotteryImgs.record }}"/>
                </view>
            </view>
            <view class="main-ant">
                <kk-lucky 
                    balance="{{ balance }}"
                    list="{{ luckyList }}"
                    activityName="{{ activity_name }}"
                    bind:onStart="handleLuckyStart"
                    bind:onFinish="handleLuckyEnd">
                </kk-lucky>
            </view>
        </view>
    </view>

    <!-- 任务 -->
    <view class="lottery-task">
        <view class="task-title">
            <image mode="widthFix" src="{{ lotteryImgs['task-title'] }}"/>
        </view>
        <view class="task-content">
            <view class="task-item" wx:for="{{ tasksList }}" wx:key="index">
                <image mode="widthFix" class="item-bg" src="{{ lotteryImgs['task-bg'] }}"/>
                <view class="item-info">
                    <view class="item-title">{{ item.title }}</view>
                    <view class="item-subtitle">
                        <image mode="widthFix" src="{{ lotteryImgs['task-icon'] }}"/>
                        <text>{{ item.subtitle }}</text>
                    </view>
                </view>
                <view class="item-button">
                    <block wx:if="{{ item.task_type == 2 && item.task_status == 0 }}">
                        <button 
                            class="lottery-login" 
                            hover-class="btn-hover" 
                            type="success" 
                            open-type="getUserInfo"
                            bindtap="originLogin"
                            wx:if="{{ !isLogin }}">
                        </button>
                        <button 
                            class="button" 
                            type="success"
                            open-type="share" 
                            data-track="{{ item.track }}"
                            share-type="{{27}}"
                            hover-class="none"
                            bindtap="tapTaskShare">
                        </button>
                    </block>
                    <button 
                        class="button"
                        hover-class="none"
                        data-type="{{ item.task_type }}"
                        data-status="{{ item.task_status }}"
                        data-action="{{ item.action }}"
                        data-track="{{ item.track }}"
                        wx:else 
                        bindtap="tapTaskButton">
                    </button>
                    <image mode="widthFix" src="{{ lotteryImgs[item.task_status ? 'task-disabled' : 'task-btn'] }}"/>
                    <text class="{{ item.task_status ? 'disabled' : '' }}">{{ item.task_status ? '已完成' : item.button_name }}</text>
                </view>
            </view>

        </view>
    </view>

</view>

<!-- 底部加载状态 -->
<view wx:else>
    <kk-bottom loading="{{ loading }}" finish="{{ false }}"></kk-bottom>
</view>

<!-- 获奖弹窗 -->
<view class="dialog" wx:if="{{ dialogInfo.show }}">
    <view class="dialog-info">
        <view class="dialog-title">{{ dialogInfo.title }}</view>
        <view class="dialog-icon" wx:if="{{ dialogInfo.icon }}" >
            <image mode="widthFix" src="{{ dialogInfo.icon }}"/>
        </view>
        <view class="dialog-subtitle" wx:if="{{ dialogInfo.subtitle }}">
            {{ dialogInfo.subtitle }}
        </view>
        <view class="dialog-btn">
            <button 
                class="lottery-login" 
                hover-class="btn-hover" 
                type="success" 
                open-type="getUserInfo"
                data-name="{{ dialogInfo.name }}"
                bindtap="originLogin"
                wx:if="{{ !isLogin }}">
            </button>
            <view class="text" bindtap="dialogClose">{{ dialogInfo.button }}</view>
        </view>
        <view class="dialog-close" bindtap="dialogClose">
            <image mode="widthFix" src="{{ lotteryImgs['close'] }}"/>
        </view>
    </view>
</view>

<!-- 中奖记录弹窗 -->
<view class="dialogRecord" wx:if="{{ dialogRecord.show }}">
    <view class="dialogRecord-info">
        <view class="dialogRecord-title">我的奖励</view>
        <view class="dialogRecord-scroll" wx:if="{{ dialogRecord.list && dialogRecord.list.length > 0 }}">
            <view class="dialogRecord-item" wx:for="{{ dialogRecord.list }}" wx:key="index">
                <image mode="widthFix" class="item-icon" wx:if="{{ item.award_assigned_icon }}" src="{{ item.award_assigned_icon }}"/>
                <view class="item-info">
                    <view class="item-title">{{ item.award_title }}</view>
                    <view class="item-date">{{ item.formatTime }}</view>
                </view>
                <block wx:if="{{ item.action }}">
                    <view class="item-tips" wx:if="{{ isiOS && item.award_type == 18 }}">请在安卓我的钱包查看</view>
                    <view class="item-btn" data-action="{{ item.action }}" wx:else bindtap="tapRecordBtn">
                        <text>查看</text>
                    </view>
                </block>
            </view>
        </view>
        <view class="dialogRecord-empty" wx:else>暂无记录</view>
        <view class="dialogRecord-close" bindtap="dialogRecordClose">
            <image mode="widthFix" src="{{ lotteryImgs['close'] }}"/>
        </view>
    </view>
</view>

<!-- 活动规则 -->
<view class="dialogRecord" wx:if="{{ dialogRuleVisible }}">
    <view class="dialogRecord-info">
        <view class="dialogRecord-title">活动规则</view>
        <view class="dialogRecord-scroll">
            <view class="dialogRule"><image mode="widthFix" src="{{ dialogRuleUrl }}" lazy-load="false"/></view>
        </view>
        <view class="dialogRecord-close" bindtap="dialogRuleClose">
            <image mode="widthFix" src="{{ lotteryImgs['close'] }}"/>
        </view>
    </view>
</view>

<!-- 获取手机号授权dialog -->
<mp-dialog
	wx:if="{{ dialog.show }}"
    show="{{ dialog.show }}"
    title="{{ dialog.title }}"
    content="{{ dialog.content }}"
    buttons="{{ dialog.button }}"
    bindbuttontap="onDialogButtontapEvent"
    bindgetphonenumber="onDiallogGetPhoneNumberEvent"
    buttonGetPhoneNumber="{{true}}">
    <!-- 内容区块：额外增加内容 slot -->
    <view slot="bd-content" class="weui-dialog__content2">
        <text class="content-two">{{dialog.contentTwo}}</text>
        <text catchtap="onDialogTapEvent" class="content-three">{{dialog.contentThree}}</text>
    </view>
</mp-dialog>

<kk-toast toast="{{ toast }}"></kk-toast>